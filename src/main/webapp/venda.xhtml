<!DOCTYPE html>
<html lang="pt-br" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:components="http://java.sun.com/jsf/composite/components">

<ui:composition template="template.xhtml">

	<ui:define name="head">
		<title>Venda</title>
		<h:outputStylesheet library="css" name="venda.css" />
	</ui:define>

	<ui:define name="conteudo">

		<p:growl id="growl" />

		<div class="p-d-flex p-jc-center p-mt-5">

			<p:panel
				styleClass="shadow-2xl shadow-gray-700 rounded-lg p-5 w-11/12 m-0">

				<p:steps styleClass="p-mb-5"
					activeIndex="#{vendaController.etapaVenda}">
					<p:menuitem value="Selecionar Produtos" />
					<p:menuitem value="Pagamento" />
				</p:steps>

				<h:panelGroup rendered="#{vendaController.etapaVenda == 0}">
					<div class="ui-inputgroup mt-10">
						<p:inputText id="pesquisa" value="#{produtoListing.pesquisa}"
							placeholder="Pesquisar produto" />
						<p:commandButton icon="pi pi-search"
							styleClass="ui-button-warning"
							actionListener="#{produtoListing.pesquisaPorFiltro}"
							process="pesquisa @this" update="@form">
						</p:commandButton>
					</div>

					<h:panelGroup id="listingfornecedor">
						<div class="p-mt-2">
							<p:commandButton
								rendered="#{vendaController.funcionario == null}"
								value="Selecionar FuncionÃ¡rio" icon="pi pi-user"
								actionListener="#{vendaController.abrirFuncionarioListing}"
								process="@this" styleClass="ui-button-warning">
								<p:ajax event="dialogReturn"
									listener="#{vendaController.obterFuncionarioListing}"
									update="@form" />
							</p:commandButton>

							<h:panelGroup rendered="#{vendaController.funcionario != null}">

								<p:chip
									label="#{funcionario.pessoaFisica.nome.trim()} #{funcionario.pessoaFisica.sobreNome.trim()}"
									removable="true">

									<p:ajax event="close" listener="#{vendaController.limpar}"
										update="@form:listingfornecedor" />
								</p:chip>

							</h:panelGroup>
						</div>
					</h:panelGroup>

					<div class="p-d-flex p-jc-center">
						<p:dataTable id="dataTable" var="produtoVenda"
							styleClass="w-7/12 p-mt-4 border-collapse border border-slate-500 rounded-md ..."
							value="#{vendaController.listaProdutoVenda}" rowSelectMode="add"
							paginatorPosition="bottom" allowUnsorting="true"
							sortMode="single" stickyTopAt=".layout-topbar" stripedRows="true"
							showGridlines="true"
							emptyMessage="Selecione algum produto para continuar a venda">

							<p:column headerText="Nome"
								rendered="#{!empty vendaController.listaProdutoVenda}">
								<h:outputText value="#{produtoVenda.produto.nome}" />
							</p:column>

							<p:column headerText="Quantidade"
								rendered="#{!empty vendaController.listaProdutoVenda}"
								width="20%">
								<p:spinner id="horizontalAfter"
									value="#{produtoVenda.quantidade}" buttons="horizontal-after"
									upButtonStyleClass="ui-button-success"
									downButtonStyleClass="ui-button-danger" min="0">
									<p:ajax event="valueChange"
										listener="#{vendaController.calcularValorTotal}"
										process="@this" update="@form" />
								</p:spinner>
							</p:column>
						</p:dataTable>
					</div>

					<p:divider />

					<h:panelGroup id="valortotal" styleClass="p-d-flex p-jc-center">
						<h2 class="text-5xl font-boldy p-mt-3 p-mr-5">Valor Total
							R$#{vendaController.valorTotal}</h2>

						<p:commandButton value="Pagamento" icon="pi pi-paypal"
							actionListener="#{vendaController.pagamento}" process="@this"
							update="@form" styleClass="p-ml-5 ui-button-success" />
					</h:panelGroup>
				</h:panelGroup>
			</p:panel>
		</div>
	</ui:define>
</ui:composition>
</html>