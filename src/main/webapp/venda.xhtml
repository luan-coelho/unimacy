<!DOCTYPE html>
<html lang="pt-br" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:components="http://java.sun.com/jsf/composite/components">

<ui:composition template="template.xhtml">

	<ui:define name="head">
		<title>Venda</title>
		<h:outputStylesheet library="css" name="venda.css" />
	</ui:define>

	<ui:define name="conteudo">

		<p:growl id="growl" />

		<div class="p-d-flex p-jc-center p-mt-5">

			<p:panel
				styleClass="shadow-2xl shadow-gray-700 rounded-lg p-5 w-12/12 m-0">

				<p:steps styleClass="p-mb-5">
					<p:menuitem value="Selecionar Produtos" />
					<p:menuitem value="Pagamento" />
				</p:steps>

				<div class="ui-inputgroup mt-10">
					<p:inputText id="pesquisa" value="#{vendaController.pesquisa}"
						placeholder="Pesquisar por..." />
					<p:selectOneMenu id="filtro" value="#{vendaController.filtro}">
						<f:selectItems value="#{vendaController.filtroProduto}"
							itemValue="#{filtro}" />
					</p:selectOneMenu>
					<p:commandButton icon="pi pi-search" styleClass="ui-button-warning"
						actionListener="#{vendaController.pesquisaPorFiltro}"
						process="pesquisa filtro @this" update="@form:picklist">
					</p:commandButton>
					<p:commandButton icon="pi pi-refresh"
						styleClass="ui-button-success p-ml-1"
						actionListener="#{vendaController.limpar}" process="@this"
						update="@form:picklist @form:growl">
					</p:commandButton>
				</div>

				<p:pickList id="picklist" styleClass="p1"
					value="#{vendaController.listaProdutoPickList}" var="lista"
					itemLabel="#{lista.produto.nome}" itemValue="#{lista}"
					showCheckbox="true" converter="produtoVendaConverter"
					showSourceControls="false" showTargetControls="false"
					effect="scale" labelDisplay="inline" addLabel="Adicionar"
					addAllLabel="Adicionar Todos" removeLabel="Remover"
					removeAllLabel="Remover Todos" transferOnDblclick="false">

					<p:ajax event="transfer"
						listener="#{vendaController.calcularValorTotal}" process="@this"
						update="valortotal" />

					<f:facet name="sourceCaption">Produtos Disponiveis</f:facet>
					<f:facet name="targetCaption">Selecionados</f:facet>

					<p:column styleClass="p-d-flex p-jc-between">
						<h:outputText value="#{lista.quantidade}" />
						<p:commandButton icon="pi pi-pencil" onclick="PF('qtd').show()"
							styleClass="rounded-button ui-button-info">
						</p:commandButton>

						<p:dialog header="Quantidade" widgetVar="qtd" minHeight="40"
							width="250" showEffect="fade">
							<p:spinner buttons="horizontal-after" value="#{lista.quantidade}"
								upButtonStyleClass="ui-button-success"
								downButtonStyleClass="ui-button-danger" stepFactor="1" min="0" />

						</p:dialog>
					</p:column>

				</p:pickList>

				<h:panelGroup id="valortotal">
					<h2 class="text-5xl font-boldy">Valor Total
						R$#{vendaController.valorTotal}</h2>
				</h:panelGroup>
			</p:panel>
		</div>
	</ui:define>
</ui:composition>
</html>